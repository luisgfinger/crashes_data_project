@startuml
title Crashes Data Project - Silver Vehicles v1 Pipeline (Activity Diagram)

start

:Load config paths;
:Find latest Bronze CSV;

if (CSV found?) then (yes)
  :Read CSV into DataFrame (dtype=string);

  :Assert required columns exist;
  :Select vehicle entity columns;
  :Rename columns to snake_case;
  :Trim string fields;

  :Cast types (unique_id, vehicle_year);
  :Apply data quality rules (DQ);
  note right
    DQ produces:
    - clean_df
    - quarantine_df
    - discard_df (optional)
    - metrics_summary
    - metrics_by_reason
    - run_date
  end note

  :Write Silver CLEAN parquet\n(partitioned by run_date);

  if (Has quarantine rows?) then (yes)
    :Write QUARANTINE parquet\n(to run_date folder);
  else (no)
    :Skip QUARANTINE write;
  endif

  :Write METRICS CSV\n(to run_date folder);

  stop
else (no)
  :Fail with "No input file found";
  stop
endif

@enduml